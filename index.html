<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Streak Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-purple-600 via-indigo-600 to-blue-600 min-h-screen p-6 text-white">
  <div class="max-w-3xl mx-auto bg-white text-gray-900 p-6 rounded-2xl shadow-2xl">
    <h1 class="text-3xl font-extrabold mb-6 flex items-center gap-2">
      🔥 Streak Calculator
    </h1>

    <!-- Input Form -->
    <div class="flex flex-col sm:flex-row gap-4 mb-6">
      <input id="goalInput" type="text" placeholder="Enter Goal" 
             class="flex-1 p-3 border rounded-lg focus:ring-2 focus:ring-purple-400 outline-none" />
      <input id="dateInput" type="date" 
             class="p-3 border rounded-lg focus:ring-2 focus:ring-purple-400 outline-none" />
      <button onclick="addGoal()" 
              class="bg-gradient-to-r from-purple-500 to-indigo-500 text-white px-6 py-2 rounded-lg shadow hover:scale-105 transition">
        ➕ Add
      </button>
    </div>

    <!-- Goals List -->
    <div id="goalsList" class="space-y-4"></div>
  </div>

<script>
  const STORAGE_KEY = "streak_goals";

  function getToday() {
    return new Date().toISOString().split("T")[0];
  }

  function loadGoals() {
    const stored = localStorage.getItem(STORAGE_KEY);
    return stored ? JSON.parse(stored) : [];
  }

  function saveGoals(goals) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(goals));
  }

  function addGoal() {
    const goal = document.getElementById("goalInput").value.trim();
    const date = document.getElementById("dateInput").value;

    if (!goal || !date) {
      alert("Please fill both fields.");
      return;
    }

    const goals = loadGoals();
    goals.push({
      id: Date.now(),
      goal,
      startDate: date,
      lastChecked: null,
      currentStreak: 0,
      maxStreak: 0,
      totalChecked: 0
    });

    saveGoals(goals);
    renderGoals();
    document.getElementById("goalInput").value = "";
    document.getElementById("dateInput").value = "";
  }

  function toggleCheck(id, checked) {
    const goals = loadGoals();
    const today = getToday();
    const goal = goals.find(g => g.id === id);
    if (!goal) return;

    if (checked) {
      if (goal.lastChecked === today) return;

      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      const yDate = yesterday.toISOString().split("T")[0];

      if (goal.lastChecked === yDate) {
        goal.currentStreak += 1;
      } else {
        goal.currentStreak = 1;
      }

      goal.maxStreak = Math.max(goal.maxStreak, goal.currentStreak);
      goal.totalChecked += 1;
      goal.lastChecked = today;
    } else {
      if (goal.lastChecked !== today) return;
      goal.lastChecked = null;
      goal.totalChecked = Math.max(0, goal.totalChecked - 1);
      goal.currentStreak = Math.max(0, goal.currentStreak - 1);
    }

    saveGoals(goals);
    renderGoals();
  }

  function deleteGoal(id) {
    if (!confirm("Delete this goal?")) return;
    let goals = loadGoals();
    goals = goals.filter(goal => goal.id !== id);
    saveGoals(goals);
    renderGoals();
  }

  function editGoal(id) {
    let goals = loadGoals();
    const goal = goals.find(g => g.id === id);
    if (!goal) return;
    const newGoalText = prompt("Edit your goal:", goal.goal);
    if (newGoalText && newGoalText.trim() !== "") {
      goal.goal = newGoalText.trim();
      saveGoals(goals);
      renderGoals();
    }
  }

  function getBadge(streak) {
    if (streak >= 30) return "🏆 Gold";
    if (streak >= 15) return "🥈 Silver";
    if (streak >= 7) return "🥉 Bronze";
    return "🎯 Starter";
  }

function renderGoals() {
  const container = document.getElementById("goalsList");
  let goals = loadGoals();
  const today = getToday();
  const todayDate = new Date(getToday());

  // ✅ Sort by success % (descending)
  goals.sort((a, b) => {
    const getSuccess = (g) => {
      const start = new Date(g.startDate);
      const diffTime = todayDate - start;
      const maxPossible = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1);
      return g.totalChecked / maxPossible;
    };
    return getSuccess(b) - getSuccess(a);
  });

  container.innerHTML = "";

  goals.forEach(goal => {
    const start = new Date(goal.startDate);
    const diffTime = todayDate - start;
    const maxPossible = Math.max(1, Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1);
    const success = ((goal.totalChecked / maxPossible) * 100).toFixed(1);

    const div = document.createElement("div");
    div.className = "p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl shadow hover:scale-[1.02] transition";

    div.innerHTML = `
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-bold">${goal.goal}</h2>
        <span class="text-sm px-2 py-1 rounded bg-purple-200 text-purple-800">${getBadge(goal.currentStreak)}</span>
      </div>
      <p class="text-sm text-gray-600 mb-2">📅 Start: ${goal.startDate}</p>

      <!-- Progress Bar -->
      <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
        <div class="bg-gradient-to-r from-purple-500 to-indigo-500 h-3 rounded-full" style="width:${success}%;"></div>
      </div>
      <p class="text-sm mb-3">Success: <strong>${success}%</strong></p>

      <div class="grid grid-cols-2 gap-2 text-sm text-gray-700 mb-3">
        <p>🔥 Current Streak: <strong>${goal.currentStreak}</strong></p>
        <p>🏅 Max Streak: <strong>${goal.maxStreak}</strong></p>
        <p>✅ Total Checks: <strong>${goal.totalChecked}</strong></p>
        <p>📈 Max Possible: <strong>${maxPossible}</strong></p>
      </div>

      <div class="flex items-center gap-3">
        <input type="checkbox" ${goal.lastChecked === today ? "checked" : ""} 
               onclick="toggleCheck(${goal.id}, this.checked)" 
               class="w-5 h-5 accent-purple-600" />
        <button onclick="editGoal(${goal.id})" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">✏️ Edit</button>
        <button onclick="deleteGoal(${goal.id})" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">🗑️ Delete</button>
      </div>
    `;

    container.appendChild(div);
  });
}

  window.onload = renderGoals;
</script>
</body>
</html>
